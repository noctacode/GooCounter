let plan=null,checking_server_plan=!1,rendering_server_plan=!1;function get_loading_html(){return'<div class="loading"><div></div><div></div><div></div><div></div></div>'}function number_with_comma(e){return(e=e||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}async function check_plan(){var e=await BG.exec("get_settings");e&&!checking_server_plan&&(checking_server_plan=!0,(plan=await BG.exec("get_server_plan",{key:e.key})).error&&(plan={error:!0,plan:plan.message,credit:0,quota:0,duration:null,lastreset:null}),checking_server_plan=!1,document.querySelector("#loading_overlay").classList.add("hidden"))}async function render_plan(){var n=await BG.exec("get_settings");if(n&&plan&&!rendering_server_plan){rendering_server_plan=!0;var n=document.querySelector("#plan"),a=document.querySelector("#credit"),s=document.querySelector("#refills"),d=document.querySelector("#ipbanned_warning"),i=Date.now()/1e3;let e=null,t=(plan.lastreset&&plan.duration&&(e=Math.floor(Math.max(0,plan.duration-(i-plan.lastreset)))),plan.plan);"Invalid key"!==t&&(t+=" Plan"),n.innerHTML=t,plan.error?n.classList.add("red"):n.classList.remove("red"),"Banned IP"===plan.plan?d.classList.remove("hidden"):d.classList.add("hidden"),0===e?(a.classList.remove("red"),a.innerHTML=get_loading_html()):(a.innerHTML=number_with_comma(plan.credit)+" / "+number_with_comma(plan.quota),0===plan.credit?a.classList.add("red"):a.classList.remove("red")),e?(i=Time.seconds_as_hms(e),s.innerHTML=""+i):s.innerHTML=get_loading_html(),0!==plan.duration&&0===e&&await check_plan(),rendering_server_plan=!1}}async function init_ui(){var e=await BG.exec("get_settings"),t=document.querySelector("#power");const n=t.querySelector(".spinning"),a=t.querySelector(".static"),s=t.querySelector(".btn");e.enabled?(a.classList.remove("hidden"),s.classList.remove("off")):s.classList.add("off");let d=null;t.addEventListener("click",async()=>{clearTimeout(d),n.classList.add("hidden"),a.classList.add("hidden"),s.classList.contains("off")?(s.classList.remove("off"),n.classList.remove("hidden"),await BG.exec("set_settings",{id:"enabled",value:!0}),await BG.exec("set_icon","on"),d=setTimeout(()=>{n.classList.add("hidden"),a.classList.remove("hidden")},1e3)):(await BG.exec("set_settings",{id:"enabled",value:!1}),await BG.exec("set_icon","off"),s.classList.add("off"))});const i=document.querySelector('.settings_text[data-settings="key"]');function r(){i.classList.contains("hiddenleft")?(i.classList.remove("hiddenleft"),i.focus()):i.classList.add("hiddenleft")}document.querySelector("#edit_key").addEventListener("click",r),i.addEventListener("keydown",e=>{"Enter"===(e=e||window.event).key&&(r(),check_plan(),0<i.value.length?document.querySelector("#export").classList.remove("hidden"):document.querySelector("#export").classList.add("hidden"))}),0<e.key?.length?document.querySelector("#export").classList.remove("hidden"):document.querySelector("#export").classList.add("hidden");for(const l of document.querySelectorAll('[data-tabtarget]:not([data-tabtarget=""])'))l.addEventListener("click",()=>{for(const e of document.querySelectorAll(".tab"))e.classList.add("hidden");document.querySelector(`[data-tab="${l.dataset.tabtarget}"]`).classList.remove("hidden")});function c(){document.querySelector(".tab:not(.hidden)").querySelector(".back")?.click()}document.addEventListener("mousedown",e=>{0<(8&(e=e||window.event).buttons)&&c()}),document.addEventListener("keydown",e=>{"Backspace"!==(e=e||window.event).key||e.target instanceof HTMLInputElement||c()});for(const[o,u]of Object.entries(e)){for(const v of document.querySelectorAll(`.settings_toggle[data-settings="${o}"]`))v.classList.remove("on","off"),v.classList.add(u?"on":"off"),v.addEventListener("click",async()=>{var e=v.classList.contains("off");await BG.exec("set_settings",{id:o,value:e}),v.classList.remove("on","off"),v.classList.add(e?"on":"off")});for(const m of document.querySelectorAll(`.settings_dropdown[data-settings="${o}"]`))m.dataset.value===u&&(m.classList.add("selected"),document.querySelector(m.dataset.displays).innerHTML=m.innerHTML),m.addEventListener("click",async()=>{document.querySelector(`.settings_dropdown.selected[data-settings="${o}"]`)?.classList?.remove("selected");var e=m.dataset.value;await BG.exec("set_settings",{id:o,value:e}),m.classList.add("selected"),document.querySelector(m.dataset.displays).innerHTML=m.innerHTML});for(const _ of document.querySelectorAll(`.settings_text[data-settings="${o}"]`))_.value=u,_.addEventListener("input",async()=>{var e=_.value;await BG.exec("set_settings",{id:o,value:e})})}for(const L of document.querySelectorAll(".locate"))L.addEventListener("click",async()=>{var e=L.dataset.key;await BG.exec("relay",{action:"start_locate",locate:e}),window.close()});document.querySelector("#export").addEventListener("click",async()=>{var e=await BG.exec("get_settings"),e=SettingsManager.export(e);window.open(e,"_blank")})}async function main(){await init_ui(),await check_plan(),await render_plan(),setInterval(render_plan,500)}document.addEventListener("DOMContentLoaded",main);
