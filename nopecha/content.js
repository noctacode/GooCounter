class BG{static exec(e,t){return new Promise(a=>{try{chrome.runtime.sendMessage({method:e,data:t},a)}catch(e){a()}})}}class Net{static async fetch(e,a){return BG.exec("fetch",{url:e,options:a})}}class Image{static encode(a){return new Promise(t=>{if(null===a)return t(null);const e=new XMLHttpRequest;e.onload=()=>{const a=new FileReader;a.onloadend=()=>{let e=a.result;if(e.startsWith("data:text/html;base64,"))return t(null);e=e.replace("data:image/jpeg;base64,",""),t(e)},a.readAsDataURL(e.response)},e.onerror=()=>{t(null)},e.onreadystatechange=()=>{4==this.readyState&&200!=this.status&&t(null)},e.open("GET",a),e.responseType="blob",e.send()})}}class NopeCHA{static INFERENCE_URL="https://api.nopecha.com";static MAX_WAIT_POST=60;static MAX_WAIT_GET=60;static ERRORS={UNKNOWN:9,INVALID_REQUEST:10,RATE_LIIMTED:11,BANNED_USER:12,NO_JOB:13,INCOMPLETE_JOB:14,INVALID_KEY:15,NO_CREDIT:16,UPDATE_REQUIRED:17};static async post({captcha_type:e,task:a,image_urls:t,image_data:r,grid:o,audio_data:n,key:i}){for(var s=Date.now(),c=await BG.exec("info_tab");!(Date.now()-s>1e3*NopeCHA.MAX_WAIT_POST);){var d={type:e,task:a,v:chrome.runtime.getManifest().version,key:i,url:c?c.url:window.location.href},d=(t&&(d.image_urls=t),r&&(d.image_data=r),o&&(d.grid=o),n&&(d.audio_data=n),await Net.fetch(NopeCHA.INFERENCE_URL,{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}}));try{var l=JSON.parse(d);if("error"in l){if(l.error===NopeCHA.ERRORS.RATE_LIMITED){await Time.sleep(2e3);continue}if(l.error===NopeCHA.ERRORS.INVALID_KEY)break;if(l.error===NopeCHA.ERRORS.NO_CREDIT)break;break}var _=l.data;return await NopeCHA.get({job_id:_,key:i})}catch(e){break}}return{job_id:null,data:null}}static async get({key:e,job_id:a}){for(var t=Date.now();!(Date.now()-t>1e3*NopeCHA.MAX_WAIT_GET);){await Time.sleep(1e3);var r=await Net.fetch(NopeCHA.INFERENCE_URL+`?id=${a}&key=`+e);try{var o=JSON.parse(r);if(!("error"in o))return{job_id:a,data:o.data,metadata:o.metadata};if(o.error!==NopeCHA.ERRORS.INCOMPLETE_JOB)return{job_id:a,data:null,metadata:null}}catch(e){break}}return{job_id:a,data:null,metadata:null}}}
