(async()=>{function a(){var e="true"===document.querySelector(".recaptcha-checkbox")?.getAttribute("aria-checked"),t=document.querySelector("#recaptcha-verify-button")?.disabled;return e||t}function d(r=15e3){return new Promise(async e=>{for(var t=Time.time();;){var a=document.querySelectorAll(".rc-imageselect-tile"),c=document.querySelectorAll(".rc-imageselect-dynamic-selected");if(0<a.length&&0===c.length)return e(!0);if(Time.time()-t>r)return e(!1);await Time.sleep(100)}})}let p=null;function e(e=500){return new Promise(m=>{let h=!1;const f=setInterval(async()=>{if(!h){h=!0;var c=document.querySelector(".rc-imageselect-instructions")?.innerText?.split("\n"),r=await async function(e){let t=null;return(t=1<e.length?(t=e.slice(0,2).join(" ")).replace(/\s+/g," ")?.trim():t.join("\n"))||null}(c);if(r){var c=3===c.length,i=document.querySelectorAll("table tr td");if(9===i.length||16===i.length){var l=[],n=Array(i.length).fill(null);let e=null,t=!1,a=0;for(const u of i){var s=u?.querySelector("img");if(!s)return void(h=!1);var o=s?.src?.trim();if(!o||""===o)return void(h=!1);300<=s.naturalWidth?e=o:100==s.naturalWidth&&(n[a]=o,t=!0),l.push(u),a++}t&&(e=null);i=JSON.stringify([e,n]);if(p!==i)return p=i,clearInterval(f),h=!1,m({task:r,is_hard:c,cells:l,background_url:e,urls:n})}}h=!1}},e)})}async function t(e){a()?(r=r||!0,e.debug&&await BG.exec("reset_recaptcha")):(r=!1,await Time.sleep(500),document.querySelector("#recaptcha-anchor")?.click())}async function c(){var c=await BG.exec("get_cache",{name:"recaptcha_visible",tab_specific:!0});if(!0===c&&(null===document.querySelector(".rc-doscaptcha-header")&&!a()))if(y=!(y||!function(){for(const e of[".rc-imageselect-incorrect-response"])if(""===document.querySelector(e)?.style.display)return 1}()||(g=[],0)),function(){for(const t of[".rc-imageselect-error-select-more",".rc-imageselect-error-dynamic-more",".rc-imageselect-error-select-something"]){var e=document.querySelector(t);if(""===e?.style.display||0===e?.tabIndex)return 1}}())g=[],await BG.exec("reset_recaptcha");else if(await d()){var{task:c,is_hard:r,cells:t,background_url:i,urls:l}=await e(),n=await BG.exec("get_settings");if(n.enabled&&n.recaptcha_auto_solve){var s=9==t.length?3:4,o=[];let e,a=[];if(null===i){e="1x1";for(let e=0;e<l.length;e++){var u=l[e],m=t[e];u&&!g.includes(u)&&(o.push(u),a.push(m))}}else o.push(i),e=s+"x"+s,a=t;var i=Time.time(),h=(await NopeCHA.post({captcha_type:IS_DEVELOPMENT?"recaptcha_dev":"recaptcha",task:c,image_urls:o,grid:e,key:n.key}))["data"];if(h){c=parseInt(n.recaptcha_solve_delay_time)||1e3,n=n.recaptcha_solve_delay?c-(Time.time()-i):0;0<n&&await Time.sleep(n);let t=0;for(let e=0;e<h.length;e++)!1!==h[e]&&(t++,function(e){try{return e.classList.contains("rc-imageselect-tileselected")}catch{}}(a[e])||a[e]?.click());for(const f of l)g.push(f),9<g.length&&g.shift();(3==s&&r&&0===t&&await d()||3==s&&!r||4==s)&&(await Time.sleep(200),document.querySelector("#recaptcha-verify-button")?.click())}}}else await BG.exec("reset_recaptcha")}let r=!1,y=!1,g=[];for(;;){await Time.sleep(1e3);var i=await BG.exec("get_settings");i&&i.enabled&&"Image"===i.recaptcha_solve_method&&(!async function(){var t=document.querySelectorAll('iframe[src*="/bframe"]');if(0<t.length){let e=!1;for(const a of t)if(e="visible"===window.getComputedStyle(a).visibility)break;e?await BG.exec("set_cache",{name:"recaptcha_visible",value:!0,tab_specific:!0}):await BG.exec("set_cache",{name:"recaptcha_visible",value:!1,tab_specific:!0})}}(),i.recaptcha_auto_open&&null!==document.querySelector(".recaptcha-checkbox")?await t(i):i.recaptcha_auto_solve&&null!==document.querySelector("#rc-imageselect")&&await c())}})();
